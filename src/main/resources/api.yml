openapi: 3.0.3
info:
  title: Task & Event Management API
  version: 1.0.0

servers:
- url: /api

paths:

  ##############################
  # EVENT MANAGEMENT (ADMIN)
  ##############################

  /events:
    get:
      summary: Get all events
      tags: [Events]
      description: Retrieve all events from the system
      responses:
        '200':
          description: List of all events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EventDto'

    post:
      summary: Create new event
      tags: [Events]
      description: Admin creates an event. Tasks will be generated for groups/employees assigned to the event.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventCreateRequest'
      responses:
        '201':
          description: Event created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventDto'

  /events/{eventId}/participants-status:
    get:
      summary: Get tasks for an event grouped by status
      tags: [Events]
      description: Returns three lists of tasks for the event: pending (NEW), done (DONE), rejected (REJECTED).
      parameters:
        - name: eventId
          in: path
          required: true
          description: Unique identifier of the event
          schema:
            type: string
      responses:
        '200':
          description: Grouped tasks by status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventTasksStatusDto'
        '404':
          description: Event not found

  ##############################
  # USER TASKS
  ##############################

  /tasks:
    get:
      summary: Get tasks assigned to current user
      tags: [Tasks]
      parameters:
      - name: X-User-Id
        in: header
        required: true
        schema:
          type: string
        description: User ID for authentication
      responses:
        '200':
          description: List of tasks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TaskDto'

  /tasks/{taskId}/done:
    post:
      summary: Mark task as done
      tags: [Tasks]
      parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Task completed

  /tasks/{taskId}/reject:
    post:
      summary: Reject a task
      tags: [Tasks]
      parameters:
      - name: taskId
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Task rejected

  ##############################
  # USER MANAGEMENT SETTINGS
  ##############################

  /users/me/categories/blacklist:
    get:
      summary: Get user's category blacklist
      tags: [User Settings]
      parameters:
      - name: X-User-Id
        in: header
        required: true
        schema:
          type: string
        description: User ID for authentication
      responses:
        '200':
          description: List of blacklisted categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

    put:
      summary: Replace user's category blacklist
      tags: [User Settings]
      parameters:
      - name: X-User-Id
        in: header
        required: true
        schema:
          type: string
        description: User ID for authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Category'
      responses:
        '200':
          description: Updated blacklist
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /users/me/notification-channels:
    get:
      summary: Get user's notification channels
      tags: [User Settings]
      parameters:
      - name: X-User-Id
        in: header
        required: true
        schema:
          type: string
        description: User ID for authentication
      responses:
        '200':
          description: Notification channels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NotificationChannel'

    put:
      summary: Replace user's notification channels
      tags: [User Settings]
      parameters:
      - name: X-User-Id
        in: header
        required: true
        schema:
          type: string
        description: User ID for authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/NotificationChannel'
      responses:
        '200':
          description: Updated notification channels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NotificationChannel'

  ##############################
  # STATISTICS
  ##############################

  /stats:
    get:
      summary: Get system statistics
      tags: [Statistics]
      parameters:
      - name: expiringHours
        in: query
        required: false
        schema:
          type: integer
          format: int64
          default: 24
        description: Threshold in hours for expiring tasks
      responses:
        '200':
          description: Statistics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatsResponse'


components:

  ##################################
  # ENUMS
  ##################################

  schemas:

    Category:
      type: string
      enum:
      - SECURITY
      - SALES
      - GENERAL
      - PARTY
      - ONBOARDING
      - TRAINING
      - HR
      - IT
      - COMPLIANCE

    GroupEnum:
      type: string
      enum:
      - UoP
      - SALES
      - BACKOFFICE
      - B2B
      - DEV
      - QA

    NotificationChannel:
      type: string
      enum:
      - EMAIL
      - SMS
      - WHATSAPP
      - MS_TEAMS

    ##################################
    # DOCUMENTS (Mongo)
    ##################################

    EventDto:
      type: object
      properties:
        id:
          type: string
          nullable: true
        category:
          $ref: '#/components/schemas/Category'
        title:
          type: string
        description:
          type: string
          nullable: true
        groups:
          type: array
          items:
            $ref: '#/components/schemas/GroupEnum'
      required: [category, title, groups]

    EventCreateRequest:
      type: object
      properties:
        category:
          $ref: '#/components/schemas/Category'
        title:
          type: string
        description:
          type: string
          nullable: true
        groups:
          type: array
          items:
            $ref: '#/components/schemas/GroupEnum'
          default: []
      required: [category, title, groups]

    TaskDto:
      type: object
      properties:
        id:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        deadline:
          type: string
          format: date-time
          nullable: true
        event:
          $ref: '#/components/schemas/EventDto'
        status:
          type: string
          enum: [NEW, DONE, REJECTED]
        actionUrl:
          type: string
          nullable: true
        employeeId:
          type: string
      required: [createdAt, event, status, employeeId]

    EmployeeDocument:
      type: object
      properties:
        id:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        categoriesBlacklist:
          type: array
          items:
            $ref: '#/components/schemas/Category'
        groups:
          type: array
          items:
            $ref: '#/components/schemas/GroupEnum'
        position:
          type: string
        notificationChannels:
          type: array
          items:
            $ref: '#/components/schemas/NotificationChannel'

    ParticipantTaskDto:
      type: object
      properties:
        id:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        deadline:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
          enum: [NEW, DONE, REJECTED]
        event:
          $ref: '#/components/schemas/EventDto'
        actionUrl:
          type: string
          nullable: true
        employeeFirstName:
          type: string
        employeeLastName:
          type: string

    ##################################
    # STATISTICS SCHEMAS
    ##################################

    StatsResponse:
      type: object
      properties:
        overallDonePercentage:
          type: number
          format: double
        overallRejectedPercentage:
          type: number
          format: double
        pendingPercentage:
          type: number
          format: double
        expiringSoonPercentage:
          type: number
          format: double
        categoryRates:
          type: array
          items:
            $ref: '#/components/schemas/CategoryCompletionRate'
        alertEmployees:
          type: array
          items:
            type: string
        totalDeliveredNotifications:
          type: integer
          format: int64
        totalUniqueClicks:
          type: integer
          format: int64
        averageCompletionHours:
          type: number
          format: double
          nullable: true
        channelEffectiveness:
          type: array
          items:
            $ref: '#/components/schemas/ChannelEffectiveness'
        channelPreferences:
          type: array
          items:
            $ref: '#/components/schemas/ChannelPreferenceSlice'

    CategoryCompletionRate:
      type: object
      properties:
        category:
          $ref: '#/components/schemas/Category'
        donePercentage:
          type: number
          format: double
        rejectedPercentage:
          type: number
          format: double
        total:
          type: integer
          format: int64
        done:
          type: integer
          format: int64
        rejected:
          type: integer
          format: int64

    ChannelEffectiveness:
      type: object
      properties:
        channel:
          $ref: '#/components/schemas/NotificationChannel'
        completionRate:
          type: number
          format: double
        tasks:
          type: integer
          format: int64

    ChannelPreferenceSlice:
      type: object
      properties:
        channel:
          $ref: '#/components/schemas/NotificationChannel'
        percentage:
          type: number
          format: double
        employees:
          type: integer
          format: int64

    EventTasksStatusDto:
      type: object
      description: Tasks for an event grouped by status (pending=NEW, done=DONE, rejected=REJECTED) with employee names.
      properties:
        pending:
          type: array
          items:
            $ref: '#/components/schemas/ParticipantTaskDto'
        done:
          type: array
          items:
            $ref: '#/components/schemas/ParticipantTaskDto'
        rejected:
          type: array
          items:
            $ref: '#/components/schemas/ParticipantTaskDto'
